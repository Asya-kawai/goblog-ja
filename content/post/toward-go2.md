+++
date = "2017-07-13T15:35:46+09:00"
title = "Go2にむけて"
draft = false
tags = ["go2"]
+++

# Go 2にむけて
[Toward Go 2](https://blog.golang.org/toward-go2) by Russ Cox

## はじめに

（この文章は本日行われた Gophercon 2017 での私の発表の書き起こしで、Goコミュニティ全体にGo 2のための議論や計画をする中での支援を求めるものです。
動画が公開されたらこちらにリンクする予定です。）

Rob Pike、Robert Griesemer、そしてKen Thompsonが新しいプログラミング言語について数日議論を重ねた後、2007年9月25日にRobが「Go」という名前を提案しました。

![mail](./mail.png)

翌年、Ian Lance Taylorと私がチームに参加し、5人で2つのコンパイラと標準ライブラリを開発し、その成果が2009年11月10日の[オープンソースリリース](https://opensource.googleblog.com/2009/11/hey-ho-lets-go.html)となりました。

![tweet](./tweet.png)

それからの2年は、できたばかりのGoのオープンソースコミュニティの支援のもとに、大小様々な変更を伴う実験をしつつGoを洗練させ、その結果が2011年10月5日に提案された[Go 1のリリース計画](https://blog.golang.org/preview-of-go-version-1)となりました。

![go1-preview](./go1-preview.png)

さらにGoコミュニティからより多くの協力をうけ、Go 1のリリース計画を改定しつつ、それを元に実装を進め、最終的に2012年3月28日に[Go 1をリリース](https://blog.golang.org/go-version-1-is-released)しました。

![go1-release](./go1-release.png)

およそ5年の歳月をかけた、創造的で熱狂的な努力の最終成果が、Go 1のリリースという形となりました。その間、命名やアイデアのリストが、安定した本番環境で利用可能な言語として形付けられました。
またこの成果は、変化や仲間内での試行錯誤から安定性の明示的な変遷の結果でもあります。

Go 1への歳月のなかで、私たちはGoを変更し、皆のGoプログラムをほぼ毎週壊していました。私たちはそういった変更がGoの本番での利用を妨げるものになっていたことは承知していました。
本番環境では言語の変更に追従するために毎週変更することなどはできませんから。[Go 1のリリース宣言のブログポスト](https://blog.golang.org/go-version-1-is-released)にも書いているように、
Go 1のリリースの主要なモチベーションは、信頼できる製品やプロジェクトや出版物（ブログ、チュートリアル、カンファレンスでの発表、書籍）を作成する安定した基盤を提供し、それによってユーザーの製品がコンパイルし続けられ、何年も変更無しで実行し続けられるという信用を勝ち取ることでした。

Go 1がリリースされた後、私たちはGoが設計された本来の目的である、本番環境での利用に時間を費やす必要があることを認識していました。それから言語の変更そのものからあえて離れ、私たちのプロジェクトでのGoの利用や実装の改善へと注力する対象を移しました。私たちはGoをさまざまな新しいシステムにポートし、Goがより効率的に実行するようにパフォーマンスに致命的なあらゆる箇所を再実装しました。また、[競合条件検出ツール（race detector）](https://blog.golang.org/race-detector)といった新しい重要なツールも追加しました。

いま、私たちはGoを大規模の本番環境に耐える品質のシステムで使う経験を5年重ねてきました。私たちはどのような機能がそのような環境に適合し、またどのような機能がそうでないかの知見をためてきました。
いまこそ、Goの進化と成長の次なる一歩をすすめ、Goの未来を計画するときです。本日、ここにGoコミュニティのみなさん、このGopherConにいる方も、その動画を見ている方も、このGoブログを後日読んでいる方も、そのすべての方々に、私たちとともにGo 2の計画や実装を進める支援をお願いいたします。

## 目標

私たちがいまGoの目標として掲げているものは2007年当時のものと変わりありません。私たちはプログラマが2つのスケーラビリティを管理するにあたって、より効率的になってほしいと考えています。まず本番環境の規模、特にクラウドソフトウェアなどの多くのサーバーと通信するような並行システムの管理。そして開発の規模、特にモダンなオープンソース開発で例示されるような疎結合で多くのエンジニアが協力しあうような巨大なコードベースの管理です。

このようなスケーラビリティはどのような規模の会社でも関係してきます。たった5人のスタートアップ企業も他の企業から提供される巨大なクラウドベースのAPIサービスを利用するでしょうし、自社開発のものよりも多くのオープンソースのソフトウェアを使うことになるでしょう。
スタートアップ企業が必要とする本番環境の規模と開発環境の規模は、Googleが必要とするそれと何も変わりません。

Go 2に対する私たちの目標は、Goがスケールする際の致命的な点を修正することにあります。

（これらの目標に関しては、Rob Pikeが2012年に書いた記事の"[Go at Google: Language Design in the Service of Software Engineering](https://talks.golang.org/2012/splash.article)"や、私の2015年のGopherConの発表の"[Go, Open Source, Community](https://blog.golang.org/open-source)"を参照してください。）

## 制約

Goの目標は当初から何も変わっていませんが、Goが持つ制約は変わっています。最も重要な制約は、既存で利用されているGoの存在です。私たちは少なくとも[世界中に50万人のGo開発者がいる](https://research.swtch.com/gophercount)と見積もっています。つまり、少なくとも何百万ものGoのソースファイルが存在し、10億行のGoコードが存在するということです。
これらのコードを書いているプログラマやこういったソースコードがGoの成功を表しています。しかし、これらはまたGo 2への制約でもあるのです。

Go 2はこれらすべての開発者とともになければなりません。私たちはこうした開発者に、古い慣習を捨て、素晴らしいと感じられるときだけ新しい慣習を覚えて欲しいとお願いする必要があります。
たとえば、Go 1以前では `error` 型で実装されていたメソッドは `String` という名前でしたが、Go 1では `Error` という名前に変更しました。これは `error` 型と自分自身で書式化できる他の型とを区別するために行われました。
ある日、私は `error` 型を実装していて、何も考えずに `Error` メソッドでなく `String` メソッドを実装していました。これはもちろんコンパイルできませんでした。5年経った今でも完全には古い慣習を捨てきれていないのです。
このようなわかりやすい名前にするための変更はGo 1では必要でしたが、Go 2ではよっぽどの理由がない限り混乱の元になるでしょう。

またGo 2は既存のすべてのGo 1のソースコードとともになければなりません。私たちはGoのエコシステムを分断させてはなりません。Go 1で書かれたパッケージをインポートしているGo 2のパッケージ、あるいはその逆、といった混在したプログラムが複数年の移行期間の中で苦労することなく動作しなければなりません。
私たちはそれをどのように実現するかを見出さなければなりません。`go fix`のような自動化ツールがある部分それを担うでしょう。

混乱を最小限にするために、すべての変更は慎重な考察や計画そしてツールを必要とします。それは代わりに変更の大きさを制限するものでもあります。大きくても2つか3つであり、確実に5つ以上ではないでしょう。

より多くの自然言語で使われる識別子をサポートしたり、2進数リテラルを追加するといった細かなメンテナンス的な変更は勘定に入れていません。細かな変更も重要ではありますが、それらは正しく動作させるのは比較的簡単です。いまここで触れているのは、大きな変更の可能性、たとえばエラー処理の追加サポートやイミュータブルや読み込み専用の値の導入、何らかのジェネリクスの追加、あるいはまだ提案されていないより重要な変更を指しています。
これらの大きな変更のうち、2つか3つしか導入できません。慎重に選ぶ必要があります。
